const imagesCar = [
    './assets/images/vroumvroum/0008-min.png',
    './assets/images/vroumvroum/0009-min.png',
    './assets/images/vroumvroum/00010-min.png',
    './assets/images/vroumvroum/00011-min.png',
    './assets/images/vroumvroum/00012-min.png',
    './assets/images/vroumvroum/00013-min.png',
    './assets/images/vroumvroum/00014-min.png',
    './assets/images/vroumvroum/00015-min.png',
    './assets/images/vroumvroum/00016-min.png',
    './assets/images/vroumvroum/00017-min.png',
    './assets/images/vroumvroum/00018-min.png',
    './assets/images/vroumvroum/00019-min.png',
    './assets/images/vroumvroum/00020-min.png',
    './assets/images/vroumvroum/00021-min.png',
    './assets/images/vroumvroum/00022-min.png',
    './assets/images/vroumvroum/00023-min.png',
    './assets/images/vroumvroum/00024-min.png',
    './assets/images/vroumvroum/00025-min.png',
    './assets/images/vroumvroum/00026-min.png',
    './assets/images/vroumvroum/00027-min.png',
    './assets/images/vroumvroum/00028-min.png',
    './assets/images/vroumvroum/00029-min.png',
    './assets/images/vroumvroum/00030-min.png',
    './assets/images/vroumvroum/00031-min.png',
    './assets/images/vroumvroum/00032-min.png',
    './assets/images/vroumvroum/00033-min.png',
    './assets/images/vroumvroum/00034-min.png',
    './assets/images/vroumvroum/00035-min.png',
    './assets/images/vroumvroum/00036-min.png',
    './assets/images/vroumvroum/00037-min.png',
    './assets/images/vroumvroum/00038-min.png',
    './assets/images/vroumvroum/00039-min.png',
    './assets/images/vroumvroum/00040-min.png',
    './assets/images/vroumvroum/00041-min.png',
    './assets/images/vroumvroum/00042-min.png',
    './assets/images/vroumvroum/00043-min.png',
    './assets/images/vroumvroum/00044-min.png',
    './assets/images/vroumvroum/00045-min.png',
    './assets/images/vroumvroum/00046-min.png',
    './assets/images/vroumvroum/00047-min.png',
    './assets/images/vroumvroum/00048-min.png',
    './assets/images/vroumvroum/00049-min.png',
    './assets/images/vroumvroum/00050-min.png',
    './assets/images/vroumvroum/00051-min.png',
    './assets/images/vroumvroum/00052-min.png',
    './assets/images/vroumvroum/00053-min.png',
    './assets/images/vroumvroum/00054-min.png',
    './assets/images/vroumvroum/00055-min.png',
    './assets/images/vroumvroum/00056-min.png',
    './assets/images/vroumvroum/00057-min.png',
    './assets/images/vroumvroum/00058-min.png',
    './assets/images/vroumvroum/00059-min.png',
    './assets/images/vroumvroum/00060-min.png',
    './assets/images/vroumvroum/00061-min.png',
    './assets/images/vroumvroum/00062-min.png',
    './assets/images/vroumvroum/00063-min.png',
    './assets/images/vroumvroum/00064-min.png',
    './assets/images/vroumvroum/00065-min.png',
    './assets/images/vroumvroum/00066-min.png',
    './assets/images/vroumvroum/00067-min.png',
    './assets/images/vroumvroum/00068-min.png',
    './assets/images/vroumvroum/00069-min.png',
    './assets/images/vroumvroum/00070-min.png',
    './assets/images/vroumvroum/00071-min.png',
    './assets/images/vroumvroum/00072-min.png',
    './assets/images/vroumvroum/00073-min.png',
    './assets/images/vroumvroum/00074-min.png',
    './assets/images/vroumvroum/00075-min.png',
    './assets/images/vroumvroum/00076-min.png',
    './assets/images/vroumvroum/00077-min.png',
    './assets/images/vroumvroum/00078-min.png',
    './assets/images/vroumvroum/00079-min.png',
    './assets/images/vroumvroum/00080-min.png',
    './assets/images/vroumvroum/00081-min.png',
    './assets/images/vroumvroum/00082-min.png',
    './assets/images/vroumvroum/00083-min.png',
    './assets/images/vroumvroum/00084-min.png',
    './assets/images/vroumvroum/00085-min.png',
    './assets/images/vroumvroum/00086-min.png',
    './assets/images/vroumvroum/00087-min.png',
    './assets/images/vroumvroum/00088-min.png',
    './assets/images/vroumvroum/00089-min.png',
    './assets/images/vroumvroum/00090-min.png',
    './assets/images/vroumvroum/00091-min.png',
    './assets/images/vroumvroum/00092-min.png',
    './assets/images/vroumvroum/00093-min.png',
    './assets/images/vroumvroum/00094-min.png',
    './assets/images/vroumvroum/00095-min.png',
    './assets/images/vroumvroum/00096-min.png',
    './assets/images/vroumvroum/00097-min.png',
    './assets/images/vroumvroum/00098-min.png',
    './assets/images/vroumvroum/00099-min.png',
    './assets/images/vroumvroum/000100-min.png',
    './assets/images/vroumvroum/000101-min.png',
    './assets/images/vroumvroum/000102-min.png',
    './assets/images/vroumvroum/000103-min.png',
    './assets/images/vroumvroum/000104-min.png',
    './assets/images/vroumvroum/000105-min.png',
    './assets/images/vroumvroum/000106-min.png',
    './assets/images/vroumvroum/000107-min.png',
    './assets/images/vroumvroum/000108-min.png',
    './assets/images/vroumvroum/000109-min.png',
    './assets/images/vroumvroum/000110-min.png',
    './assets/images/vroumvroum/000111-min.png',
    './assets/images/vroumvroum/000112-min.png',
    './assets/images/vroumvroum/000113-min.png',
    './assets/images/vroumvroum/000114-min.png',
    './assets/images/vroumvroum/000115-min.png',
    './assets/images/vroumvroum/000116-min.png',
    './assets/images/vroumvroum/000117-min.png',
    './assets/images/vroumvroum/000118-min.png',
    './assets/images/vroumvroum/000119-min.png',
    './assets/images/vroumvroum/000120-min.png',
    './assets/images/vroumvroum/000121-min.png',
    './assets/images/vroumvroum/000122-min.png',
    './assets/images/vroumvroum/000123-min.png',
    './assets/images/vroumvroum/000124-min.png',
    './assets/images/vroumvroum/000125-min.png',
    './assets/images/vroumvroum/000126-min.png',
    './assets/images/vroumvroum/000127-min.png',
    './assets/images/vroumvroum/000128-min.png',
    './assets/images/vroumvroum/000129-min.png',
    './assets/images/vroumvroum/000130-min.png',
    './assets/images/vroumvroum/000131-min.png',
    './assets/images/vroumvroum/000132-min.png',
    './assets/images/vroumvroum/000133-min.png',
    './assets/images/vroumvroum/000134-min.png',
    './assets/images/vroumvroum/000135-min.png',
    './assets/images/vroumvroum/000136-min.png',
    './assets/images/vroumvroum/000137-min.png',
    './assets/images/vroumvroum/000138-min.png',
    './assets/images/vroumvroum/000139-min.png',
    './assets/images/vroumvroum/000140-min.png',
    './assets/images/vroumvroum/000141-min.png',
    './assets/images/vroumvroum/000142-min.png',
    './assets/images/vroumvroum/000143-min.png',
    './assets/images/vroumvroum/000144-min.png',
    './assets/images/vroumvroum/000145-min.png',
    './assets/images/vroumvroum/000146-min.png',
    './assets/images/vroumvroum/000147-min.png',
    './assets/images/vroumvroum/000148-min.png',
    './assets/images/vroumvroum/000149-min.png',
    './assets/images/vroumvroum/000150-min.png',
    './assets/images/vroumvroum/000151-min.png',
    './assets/images/vroumvroum/000152-min.png',
    './assets/images/vroumvroum/000153-min.png',
    // './assets/images/vroumvroum/000154-min.png',
    // './assets/images/vroumvroum/000155-min.png',
    // './assets/images/vroumvroum/000156-min.png',
    // './assets/images/vroumvroum/000157-min.png',
    // './assets/images/vroumvroum/000158-min.png',
    // './assets/images/vroumvroum/000159-min.png',
    // './assets/images/vroumvroum/000160-min.png',
    // './assets/images/vroumvroum/000161-min.png',
    // './assets/images/vroumvroum/000162-min.png',
    // './assets/images/vroumvroum/000163-min.png',
    // './assets/images/vroumvroum/000164-min.png',
    // './assets/images/vroumvroum/000165-min.png',
    // './assets/images/vroumvroum/000166-min.png',
    // './assets/images/vroumvroum/000167-min.png',
    // './assets/images/vroumvroum/000168-min.png',
    // './assets/images/vroumvroum/000169-min.png',
    // './assets/images/vroumvroum/000170-min.png',
    // './assets/images/vroumvroum/000171-min.png',
    // './assets/images/vroumvroum/000172-min.png',
    // './assets/images/vroumvroum/000173-min.png',
    // './assets/images/vroumvroum/000174-min.png',
    // './assets/images/vroumvroum/000175-min.png',
    // './assets/images/vroumvroum/000176-min.png',
    // './assets/images/vroumvroum/000177-min.png',
    // './assets/images/vroumvroum/000178-min.png',
    // './assets/images/vroumvroum/000179-min.png',
    // './assets/images/vroumvroum/000180-min.png',
    // './assets/images/vroumvroum/000181-min.png',
    // './assets/images/vroumvroum/000182-min.png',
    // './assets/images/vroumvroum/000183-min.png',
    // './assets/images/vroumvroum/000184-min.png',
    // './assets/images/vroumvroum/000185-min.png',
    // './assets/images/vroumvroum/000186-min.png',
    // './assets/images/vroumvroum/000187-min.png',
    // './assets/images/vroumvroum/000188-min.png',
    // './assets/images/vroumvroum/000189-min.png',
    // './assets/images/vroumvroum/000190-min.png',
    // './assets/images/vroumvroum/000191-min.png',
    // './assets/images/vroumvroum/000192-min.png',
    // './assets/images/vroumvroum/000193-min.png',
    // './assets/images/vroumvroum/000194-min.png',
    // './assets/images/vroumvroum/000195-min.png',
    // './assets/images/vroumvroum/000196-min.png',
    // './assets/images/vroumvroum/000197-min.png',
    // './assets/images/vroumvroum/000198-min.png',
    // './assets/images/vroumvroum/000199-min.png',
    // './assets/images/vroumvroum/000200-min.png',
    // './assets/images/vroumvroum/000201-min.png',
    // './assets/images/vroumvroum/000202-min.png',
    // './assets/images/vroumvroum/000203-min.png',
    // './assets/images/vroumvroum/000204-min.png',
    // './assets/images/vroumvroum/000205-min.png',
    // './assets/images/vroumvroum/000206-min.png',
    // './assets/images/vroumvroum/000207-min.png',
    // './assets/images/vroumvroum/000208-min.png',
    // './assets/images/vroumvroum/000209-min.png',
    // './assets/images/vroumvroum/000210-min.png',
    // './assets/images/vroumvroum/000211-min.png',
    // './assets/images/vroumvroum/000212-min.png',
    // './assets/images/vroumvroum/000213-min.png',
    // './assets/images/vroumvroum/000214-min.png',
    // './assets/images/vroumvroum/000215-min.png',
    // './assets/images/vroumvroum/000216-min.png',
    // './assets/images/vroumvroum/000217-min.png',
    // './assets/images/vroumvroum/000218-min.png',
    // './assets/images/vroumvroum/000219-min.png',
    // './assets/images/vroumvroum/000220-min.png',
    // './assets/images/vroumvroum/000221-min.png',
    // './assets/images/vroumvroum/000222-min.png',
    // './assets/images/vroumvroum/000223-min.png',
    // './assets/images/vroumvroum/000224-min.png',
    // './assets/images/vroumvroum/000225-min.png',
    // './assets/images/vroumvroum/000226-min.png',
    // './assets/images/vroumvroum/000227-min.png',
    // './assets/images/vroumvroum/000228-min.png',
    // './assets/images/vroumvroum/000229-min.png',
    // './assets/images/vroumvroum/000230-min.png',
    // './assets/images/vroumvroum/000231-min.png',
    // './assets/images/vroumvroum/000232-min.png',
    // './assets/images/vroumvroum/000233-min.png',
    // './assets/images/vroumvroum/000234-min.png',
    // './assets/images/vroumvroum/000235-min.png',
    // './assets/images/vroumvroum/000236-min.png',
    // './assets/images/vroumvroum/000237-min.png',
    // './assets/images/vroumvroum/000238-min.png',
    // './assets/images/vroumvroum/000239-min.png',
    // './assets/images/vroumvroum/000240-min.png',
    // './assets/images/vroumvroum/000241-min.png',
    // './assets/images/vroumvroum/000242-min.png',
    // './assets/images/vroumvroum/000243-min.png',
    // './assets/images/vroumvroum/000244-min.png',
    // './assets/images/vroumvroum/000245-min.png',
    // './assets/images/vroumvroum/000246-min.png',
    // './assets/images/vroumvroum/000247-min.png',
    // './assets/images/vroumvroum/000248-min.png',
    // './assets/images/vroumvroum/000249-min.png',
    // './assets/images/vroumvroum/000250-min.png',
    // './assets/images/vroumvroum/000251-min.png',
    // './assets/images/vroumvroum/000252-min.png',
    // './assets/images/vroumvroum/000253-min.png',
    // './assets/images/vroumvroum/000254-min.png',
    // './assets/images/vroumvroum/000255-min.png',
    // './assets/images/vroumvroum/000256-min.png',
    // './assets/images/vroumvroum/000257-min.png',
    // './assets/images/vroumvroum/000258-min.png',
    // './assets/images/vroumvroum/000259-min.png',
    // './assets/images/vroumvroum/000260-min.png',
    // './assets/images/vroumvroum/000261-min.png',
    // './assets/images/vroumvroum/000262-min.png',
    // './assets/images/vroumvroum/000263-min.png',
    // './assets/images/vroumvroum/000264-min.png',
    // './assets/images/vroumvroum/000265-min.png',
    // './assets/images/vroumvroum/000266-min.png',
    // './assets/images/vroumvroum/000267-min.png',
    // './assets/images/vroumvroum/000268-min.png',
    // './assets/images/vroumvroum/000269-min.png',
    // './assets/images/vroumvroum/000270-min.png',
    // './assets/images/vroumvroum/000271-min.png',
    // './assets/images/vroumvroum/000272-min.png',
    // './assets/images/vroumvroum/000273-min.png',
    // './assets/images/vroumvroum/000274-min.png',
    // './assets/images/vroumvroum/000275-min.png',
    // './assets/images/vroumvroum/000276-min.png',
    // './assets/images/vroumvroum/000277-min.png',
    // './assets/images/vroumvroum/000278-min.png',
    // './assets/images/vroumvroum/000279-min.png',
    // './assets/images/vroumvroum/000280-min.png',
    // './assets/images/vroumvroum/000281-min.png',
    // './assets/images/vroumvroum/000282-min.png',
    // './assets/images/vroumvroum/000283-min.png',
    // './assets/images/vroumvroum/000284-min.png',
    // './assets/images/vroumvroum/000285-min.png',
    // './assets/images/vroumvroum/000286-min.png',
    // './assets/images/vroumvroum/000287-min.png',
    // './assets/images/vroumvroum/000288-min.png',
    // './assets/images/vroumvroum/000289-min.png',
    // './assets/images/vroumvroum/000290-min.png',
    // './assets/images/vroumvroum/000291-min.png',
    // './assets/images/vroumvroum/000292-min.png',
    // './assets/images/vroumvroum/000293-min.png',
    // './assets/images/vroumvroum/000294-min.png',
    // './assets/images/vroumvroum/000295-min.png',
    // './assets/images/vroumvroum/000296-min.png',
    // './assets/images/vroumvroum/000297-min.png',
    // './assets/images/vroumvroum/000298-min.png',
    // './assets/images/vroumvroum/000299-min.png',
    // './assets/images/vroumvroum/000300-min.png',
    // './assets/images/vroumvroum/000301-min.png',
    // './assets/images/vroumvroum/000302-min.png',
    // './assets/images/vroumvroum/000303-min.png',
    // './assets/images/vroumvroum/000304-min.png',
    // './assets/images/vroumvroum/000305-min.png',
    // './assets/images/vroumvroum/000306-min.png',
    // './assets/images/vroumvroum/000307-min.png',
    // './assets/images/vroumvroum/000308-min.png',
]

function locomotive() {
    gsap.registerPlugin(ScrollTrigger)

    const locoScroll = new LocomotiveScroll({
        el: document.querySelector('#main--container'),
        smooth: true,
    })

    locoScroll.on('scroll', ScrollTrigger.update)

    ScrollTrigger.scrollerProxy('#main--container', {
        scrollTop(value) {
            return arguments.length
                ? locoScroll.scrollTo(value, 0, 0)
                : locoScroll.scroll.instance.scroll.y
        },

        getBoundingClientRect() {
            return {
                top: 0,
                left: 0,
                width: window.innerWidth,
                height: window.innerHeight,
            }
        },

        pinType: document.querySelector('#main--container').style.transform
            ? 'transform'
            : 'fixed',
    })
    ScrollTrigger.addEventListener('refresh', () => locoScroll.update())
    ScrollTrigger.refresh()
}

locomotive()

const canvas = document.querySelector('canvas')
const context = canvas.getContext('2d')

canvas.width = window.innerWidth
canvas.height = window.innerHeight

window.addEventListener('resize', function () {
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    render()
})

const frameCount = imagesCar.length

const images = []
const imageSeq = {
    frame: 1,
}

for (let i = 0; i < frameCount; i++) {
    const img = new Image()
    img.src = imagesCar[i]
    images.push(img)
}

gsap.to(imageSeq, {
    frame: frameCount - 1,
    snap: 'frame',
    ease: `none`,
    scrollTrigger: {
        scrub: 0.15,
        trigger: `#content>canvas`,
        start: `top top`,
        end: `775% top`,
        scroller: `#main--container`,
    },
    onUpdate: render,
})

images[1].onload = render

function render() {
    scaleImage(images[imageSeq.frame], context)
}

function scaleImage(img, ctx) {
    const canvas = ctx.canvas
    const hRatio = canvas.width / img.width
    const vRatio = canvas.height / img.height
    const ratio = Math.max(hRatio, vRatio)
    const centerShift_x = (canvas.width - img.width * ratio) / 2
    const centerShift_y = (canvas.height - img.height * ratio) / 2

    ctx.clearRect(0, 0, canvas.width, canvas.height)
    ctx.drawImage(
        img,
        0,
        0,
        img.width,
        img.height,
        centerShift_x,
        centerShift_y,
        img.width * ratio,
        img.height * ratio,
    )
}

function triggerVideo() {
    const video = document.querySelector('video')
    video.style.opacity = 1
    video.play()

    setTimeout(() => {
        video.style.opacity = 0
    }, 20000)
}

function hiddenVideo() {
    const video = document.querySelector('video')
    video.style.opacity = 0
    video.currentTime = 0
    video.pause()
}

ScrollTrigger.create({
    trigger: '#content>canvas',
    pin: true,
    scroller: `#main--container`,
    start: `top top`,
    end: `800% top`,
    onLeave: () => triggerVideo(),
    onEnterBack: () => hiddenVideo(),
})

gsap.to('#page1', {
    scrollTrigger: {
        trigger: `#page1`,
        start: `top top`,
        end: `bottom top`,
        pin: true,
        scroller: `#main--container`,
    },
})

gsap.to('#page2', {
    scrollTrigger: {
        trigger: `#page2`,
        start: `top top`,
        end: `bottom top`,
        pin: true,
        scroller: `#main--container`,
    },
})

gsap.to('#section-3', {
    scrollTrigger: {
        trigger: `#section-3`,
        start: `top top`,
        end: `bottom top`,
        pin: true,
        scroller: `#main--container`,
    },
})

gsap.to('#section-4', {
    scrollTrigger: {
        trigger: '#section-4',
        start: 'top top',
        end: 'bottom top',
        pin: true,
        scroller: `#main--container`,
    },
})

gsap.to('#panel--left', {
    xPercent: 100,
    ease: 'nEase',
    scrollTrigger: {
        trigger: '#panel--left',
        start: 'center center',
        end: 'bottom top',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#panel--right', {
    xPercent: -100,
    ease: 'nEase',
    scrollTrigger: {
        trigger: '#panel--left',
        start: 'top top',
        end: 'bottom top',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#page1>#right-text', {
    xPercent: 200,
    scrollTrigger: {
        trigger: '#right-text',
        start: 'top top',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#page1>#left-text', {
    opacity: 1,
    ease: 'none',
    scrollTrigger: {
        trigger: '#left-text',
        start: 'bottom center',
        end: 'bottom center',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#page2>#right-text', {
    xPercent: -200,
    scrollTrigger: {
        trigger: '#page2>#right-text',
        start: 'top top',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#page2>#left-text', {
    opacity: 1,
    ease: 'none',
    scrollTrigger: {
        trigger: '#page2>#left-text',
        start: 'bottom center',
        end: 'bottom center',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#bottom-banner', {
    xPercent: 100,
    opacity: 1,
    ease: 'power1.out',
    scrollTrigger: {
        trigger: '#bottom-banner',
        start: 'bottom center',
        end: 'bottom center',
        scrub: 1,
        scroller: `#main--container`,
    },
})

gsap.to('#top-banner', {
    xPercent: -100,
    opacity: 1,
    ease: 'power1.out',
    scrollTrigger: {
        trigger: '#top-banner',
        start: 'bottom center',
        end: 'bottom center',
        scrub: 1,
        scroller: `#main--container`,
    },
})
